Code inspired by boost project